pre_install() {
	# make backup of files that will be replaced by package files
	cp /etc/locale.gen /etc/locale.gen.backup
	cp /etc/pacman.conf /etc/pacman.conf.backup
	cp /etc/xdg/reflector/reflector.conf /etc/xdg/reflector/reflector.conf.backup
}

post_install() {
	# set timezone
	ln -sf /usr/share/zoneinfo/Europe/Berlin /etc/localtime

	post_upgrade
}

#pre_upgrade() {
	# do something here
#}

post_upgrade() {
	## rename package files
	mv -f /etc/hosts.fefe /etc/hosts
	mv -f /etc/locale.conf.fefe /etc/locale.conf
	mv -f /etc/locale.gen.fefe /etc/locale.gen
	mv -f /etc/xdg/reflector/reflector.conf.fefe /etc/xdg/reflector/reflector.conf
	mv -f /etc/pacman.conf.fefe /etc/pacman.conf
	mv -f /etc/vconsole.conf.fefe /etc/vconsole.conf

	## input hostname in hosts file
	if [ -n "$(cat /etc/hostname)" ]; then
		sed -i "s/^##hostname_gets_auto_replaced##/$(cat /etc/hostname)/" /etc/hosts
	else
		echo "Failed to set hostname in \"/etc/hosts\":"
		echo "WARNING: \"/etc/hostname\" is empty"
	fi

	## generate locales in locale.gen
	# TODO: use pacman hook
	locale-gen

	# TODO: add packman hook to clear pacman package cache (keep last 3 versions for installed packages and 1 version for uninstalled packages)

	## enable Services for autostart
	systemctl enable --now NetworkManager
	systemctl enable --now reflector.timer # periodicaly update mirrorlist
	systemctl enable --now bluetooth.service
	systemctl enable --now sshd.service
}

#pre_remove() {
	# do something here
#}

post_remove() {
	## restore files from backup that had beed replaced by package files
	mv /etc/locale.gen.backup /etc/locale.gen
	mv /etc/pacman.conf.backup /etc/pacman.conf
	mv /etc/xdg/reflector/reflector.conf.backup /etc/xdg/reflector/reflector.conf
}
